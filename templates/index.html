<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ëª…ë¦¬ ê¸°ë°˜ 3ê°œë…„ íˆ¬ì ì „ëµ</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btn { width: 100%; padding: 12px; border-radius: 10px; border: 0; background: #111; color: #fff; cursor: pointer; }
    .muted { color: #666; font-size: 13px; }
    pre { white-space: pre-wrap; word-break: break-word; background: #0b0f14; color: #d9e6ff; padding: 14px; border-radius: 12px; overflow: auto; }
    details summary { cursor: pointer; font-weight: 600; }
  </style>
</head>
<body>

  <h1>â˜¯ï¸ ëª…ë¦¬ ê¸°ë°˜ 3ê°œë…„ íˆ¬ì ì „ëµ</h1>
  <p class="muted">PDF ì† ì „ë¬¸ ì§€ì‹ìœ¼ë¡œ ë‹¹ì‹ ì˜ íˆ¬ì íë¦„ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>

  <div class="card">
    <form action="/analyze" method="post">
      <div class="grid">
        <div>
          <label>ì´ë¦„</label>
          <input name="name" value="{{ user.name if user else '' }}" required />
        </div>
        <div>
          <label>ìƒë…„ì›”ì¼ (mm/dd/yyyy)</label>
          <input name="birth_date" value="{{ user.birth_date if user else '' }}" required />
        </div>
        <div>
          <label>íƒœì–´ë‚œ ì‹œ (ì˜ˆ: 14:30 / ëª¨ë¦„)</label>
          <input name="birth_time" value="{{ user.birth_time if user else 'ëª¨ë¦„' }}" />
        </div>
        <div>
          <label>ì„±ë³„</label>
          <select name="gender" required>
            <option value="" {% if not user %}selected{% endif %}>ì„ íƒ</option>
            <option value="ë‚¨" {% if user and user.gender=='ë‚¨' %}selected{% endif %}>ë‚¨</option>
            <option value="ì—¬" {% if user and user.gender=='ì—¬' %}selected{% endif %}>ì—¬</option>
          </select>
        </div>
      </div>
      <div style="margin-top:12px;">
        <button class="btn" type="submit">ê°œì¸ ì‚¬ì£¼ ë¶„ì„ ë° íˆ¬ì ë°©í–¥ ì œì‹œ</button>
      </div>
    </form>
  </div>

  {% if result %}
  <div class="card">
    <h2 style="margin-top:0;">ê²°ê³¼</h2>
    <p><b>ìƒíƒœ:</b> {{ result.status }}</p>

    {% if result.input_echo %}
      <p class="muted"><b>ì…ë ¥ í™•ì¸:</b>
        {{ result.input_echo.birth_date }} /
        {{ result.input_echo.birth_time }} /
        {{ result.input_echo.gender }}
      </p>
    {% endif %}

    {% if result.saju_overview %}
      <h3>ì‚¬ì£¼ ì „ë°˜</h3>
      <pre>{{ result.saju_overview }}</pre>
    {% endif %}

    <h3>íˆ¬ì ë¶„ì„</h3>
    <pre>{{ result.analysis }}</pre>

    {% if result.year_1 %}<h3>2026ë…„ ì „ëµ</h3><pre>{{ result.year_1 }}</pre>{% endif %}
    {% if result.year_2 %}<h3>2027ë…„ ì „ëµ</h3><pre>{{ result.year_2 }}</pre>{% endif %}
    {% if result.year_3 %}<h3>2028ë…„ ì „ëµ</h3><pre>{{ result.year_3 }}</pre>{% endif %}
  </div>
  {% endif %}

  <!-- âœ… ê²€ì¦ìš©: ì›¹í˜ì´ì§€ ë§¨ ì•„ë˜ì— í”„ë¡¬í”„íŠ¸ ì¶œë ¥ -->
  <div class="card">
    <details {% if prompt_text %}open{% endif %}>
      <summary>ğŸ” Debug Prompt (ëª¨ë¸ì— ë³´ë‚¸ í”„ë¡¬í”„íŠ¸ ì›ë¬¸)</summary>
      {% if prompt_text %}
        <pre>{{ prompt_text | e }}</pre>
      {% else %}
        <p class="muted">ì•„ì§ ë¶„ì„ì„ ì‹¤í–‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
      {% endif %}
    </details>
  </div>

</body>
</html>
